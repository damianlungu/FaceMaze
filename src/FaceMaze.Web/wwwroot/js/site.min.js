function defaultImage(t){return t.onerror=null,t.src="/images/noimage.gif",!0}function Play(){function t(){setTimeout(i,30)}function i(){var t=(new Date).getTime();$.ajax({datatype:"json",type:"GET",url:"/data/db-handler.php",data:{timestamp:t,action:"get"},success:function(t){$("#highscore-list").text("");for(var i=0;i<t.length;i++)$("#highscore-list").append("<li>"+t[i].name+"<span id='score'>"+t[i].score+"</span></li>")}})}function e(t,i,e){$.ajax({type:"POST",url:"/data/db-handler.php",data:{action:"add",name:t,score:i,level:e},dataType:"json",success:function(t){console.log("Highscore added: "+t),$("#highscore-form").html('<span class="menu-buton" id="show-highscore">View Highscore List</span>')},error:function(t){console.log(t)}})}function s(){var t=$("input[type=text]").val();$("#highscore-form").html("Saving highscore..."),e(t,w.score.score,w.level)}function n(){this.radius=15,this.posX=0,this.posY=12*this.radius,this.speed=5,this.angle1=.25,this.angle2=1.75,this.mouth=1,this.dirX=E.dirX,this.dirY=E.dirY,this.lives=3,this.stuckX=0,this.stuckY=0,this.frozen=!1,this.freeze=function(){this.frozen=!0},this.unfreeze=function(){this.frozen=!1},this.getCenterX=function(){return this.posX+this.radius},this.getCenterY=function(){return this.posY+this.radius},this.directionWatcher=new l,this.direction=E,this.beastMode=!1,this.beastModeTimer=0,this.checkCollisions=function(){if(0==this.stuckX&&0==this.stuckY&&0==this.frozen){var t=this.getGridPosX(),i=this.getGridPosY(),e=t,s=i,o=w.getMapContent(t,i);1==this.dirX&&17>e&&(e+=1),1==this.dirY&&12>s&&(s+=1);var r=w.getMapContent(e,s);if(("pill"===o||"eatfruit"===o)&&(1==this.dirX&&h(this.posX,w.toPixelPos(t)+this.radius-5,w.toPixelPos(t+1))||-1==this.dirX&&h(this.posX,w.toPixelPos(t),w.toPixelPos(t)+5)||1==this.dirY&&h(this.posY,w.toPixelPos(i)+this.radius-5,w.toPixelPos(i+1))||-1==this.dirY&&h(this.posY,w.toPixelPos(i),w.toPixelPos(i)+5)||"wall"===r)){var a;"eatfruit"===o?(C.play("eatfruit"),a=50,this.enableBeastMode(),w.startenemyFriendFrightened()):(C.play("chomp"),a=10,w.pillCount--),w.map.posY[i].posX[t].type="null",w.score.add(a)}("wall"===r||"door"===r)&&(this.stuckX=this.dirX,this.stuckY=this.dirY,n.stop(),1==this.stuckX&&this.posX%2*this.radius!=0&&(this.posX-=5),1==this.stuckY&&this.posY%2*this.radius!=0&&(this.posY-=5),-1==this.stuckX&&(this.posX+=5),-1==this.stuckY&&(this.posY+=5))}},this.checkDirectionChange=function(){if(null!=this.directionWatcher.get())if(1==this.stuckX&&this.directionWatcher.get()==E)this.directionWatcher.set(null);else if(this.stuckX=0,this.stuckY=0,this.inGrid()){console.log("x: "+this.getGridPosX()+" + "+this.directionWatcher.get().dirX),console.log("y: "+this.getGridPosY()+" + "+this.directionWatcher.get().dirY);var t=this.getGridPosX()+this.directionWatcher.get().dirX,i=this.getGridPosY()+this.directionWatcher.get().dirY;-1>=t&&(t=w.width/(2*this.radius)-1),t>=w.width/(2*this.radius)&&(t=0),-1>=i&&(t=w.height/(2*this.radius)-1),i>=w.heigth/(2*this.radius)&&(i=0),console.log("x: "+t),console.log("y: "+i);var e=w.map.posY[i].posX[t].type;console.log("checkNextTile: "+e),"wall"!=e&&(this.setDirection(this.directionWatcher.get()),this.directionWatcher.set(null))}},this.setDirection=function(t){this.frozen||(this.dirX=t.dirX,this.dirY=t.dirY,this.angle1=t.angle1,this.angle2=t.angle2,this.direction=t)},this.enableBeastMode=function(){this.beastMode=!0,this.beastModeTimer=240,Y.dazzle(),P.dazzle(),M.dazzle(),b.dazzle()},this.disableBeastMode=function(){this.beastMode=!1,Y.undazzle(),P.undazzle(),M.undazzle(),b.undazzle()},this.move=function(){this.frozen?this.deathAnimation():(this.beastModeTimer>0&&this.beastModeTimer--,0==this.beastModeTimer&&1==this.beastMode&&this.disableBeastMode(),this.posX+=this.speed*this.dirX,this.posY+=this.speed*this.dirY,this.posX>=w.width-this.radius&&(this.posX=5-this.radius),this.posX<=0-this.radius&&(this.posX=w.width-5-this.radius),this.posY>=w.height-this.radius&&(this.posY=5-this.radius),this.posY<=0-this.radius&&(this.posY=w.height-5-this.radius))},this.eat=function(){if(!this.frozen&&this.dirX==this.dirY==0){this.angle1-=.07*this.mouth,this.angle2+=.07*this.mouth;var t=this.direction.angle1,i=this.direction.angle2,e=this.direction.angle1-.21,s=this.direction.angle2+.21;(this.angle1<e||this.angle2>s)&&(this.mouth=-1),(this.angle1>=t||this.angle2<=i)&&(this.mouth=1)}},this.stop=function(){this.dirX=0,this.dirY=0},this.reset=function(){this.unfreeze(),this.posX=0,this.posY=12*this.radius,this.setDirection(E),this.stop(),this.stuckX=0,this.stuckY=0},this.deathAnimation=function(){this.angle1+=.05,this.angle2-=.05,(this.angle1>=this.direction.angle1+.7||this.angle2<=this.direction.angle2-.7)&&this.deathFinal()},this.death=function(){C.play("death"),this.freeze(),this.deathAnimation()},this.deathFinal=function(){if(this.reset(),P.reset(),Y.reset(),M.reset(),b.reset(),this.lives--,console.log("pacman deathd, "+this.lives+" lives left"),this.lives<=0){var t="<div id='highscore-form'><span id='form-validater'></span><input type='text' id='playerName'/><span class='button' id='score-submit'>save</span></div>";w.showMessage("Game over","Total Score: "+w.score.score+t),w.gameOver=!0,$("#playerName").focus()}w.drawHearts(this.lives)},this.getGridPosX=function(){return(this.posX-this.posX%30)/30},this.getGridPosY=function(){return(this.posY-this.posY%30)/30}}function o(t,i,e,s,o){console.log("BuildWall"),s=2*s-1,o=2*o-1,t.fillRect(n.radius/2+2*i*n.radius,n.radius/2+2*e*n.radius,s*n.radius,o*n.radius)}function h(t,i,e){return t>=i&&e>=t}function r(){this.time_diff=0,this.time_start=0,this.time_stop=0,this.start=function(){this.time_start=(new Date).getTime()},this.stop=function(){this.time_stop=(new Date).getTime(),this.time_diff+=this.time_stop-this.time_start,this.time_stop=0,this.time_start=0},this.reset=function(){this.time_diff=0,this.time_start=0,this.time_stop=0},this.get_time_diff=function(){return this.time_diff}}function a(){this.timer=new r,this.refreshRate=33,this.running=!1,this.pause=!0,this.score=new d,this.soundfx=0,this.map,this.pillCount,this.monsters,this.level=1,this.refreshLevel=function(t){$(t).html("Lvl: "+this.level)},this.gameOver=!1,this.canvas=$("#gameCanvas").get(0),this.wallColor="Blue",this.width=this.canvas.width,this.height=this.canvas.height,this.pillSize=3,this.eatfruitSizeMin=2,this.eatfruitSizeMax=6,this.eatfruitSizeCurrent=this.eatfruitSizeMax,this.eatfruitAnimationCounter=0,this.nexteatfruitSize=function(){return this.eatfruitSizeCurrent},this.enemyFriendFrightened=!1,this.enemyFriendFrightenedTimer=240,this.enemyFriendMode=0,this.enemyFriendModeTimer=200,this.enemyFriendSpeedNormal=this.level>4?3:2,this.enemyFriendSpeedDazzled=2,this.startenemyFriendFrightened=function(){console.log("enemyFriend frigthened"),this.enemyFriendFrightened=!0,this.enemyFriendFrightenedTimer=240,Y.dazzle(),P.dazzle(),M.dazzle(),b.dazzle()},this.endenemyFriendFrightened=function(){console.log("enemyFriend frigthened end"),this.enemyFriendFrightened=!1,Y.undazzle(),P.undazzle(),M.undazzle(),b.undazzle()},this.checkenemyFriendMode=function(){this.enemyFriendFrightened&&(this.enemyFriendFrightenedTimer--,0===this.enemyFriendFrightenedTimer&&(this.endenemyFriendFrightened(),this.enemyFriendFrigthenedTimer=240)),this.enemyFriendModeTimer--,0===this.enemyFriendModeTimer&&w.level>1&&(this.enemyFriendMode^=1,this.enemyFriendModeTimer=200+450*this.enemyFriendMode,console.log("enemyFriendMode="+this.enemyFriendMode),w.buildWalls(),Y.reverseDirection(),P.reverseDirection(),b.reverseDirection(),M.reverseDirection())},this.getMapContent=function(t,i){var e=w.width/30-1,s=w.height/30-1;return 0>t&&(t=e+t),t>e&&(t-=e),0>i&&(i=s+i),i>s&&(i-=s),this.map.posY[i].posX[t].type},this.setMapContent=function(t,i,e){this.map.posY[i].posX[t].type=e},this.toggleSound=function(){this.soundfx=0===this.soundfx?1:0,$("#mute").toggle()},this.reset=function(){},this.newGame=function(){var t=confirm("Are you sure you want to restart?");t&&(console.log("New Game"),this.init(0),this.pauseResume())},this.nextLevel=function(){this.level++,console.log("Level "+w.level),w.showMessage("Level "+w.level,this.getLevelTitle()+"<br/>(Click to continue!)"),w.refreshLevel(".level"),this.init(1)},this.drawHearts=function(t){for(var i="",e=0;t>e;e++)i+=" <img src='/images/game/heart.png'>";$(".lives").html("Lives: "+i)},this.showContent=function(t){$(".content").hide(),$("#"+t).show()},this.getLevelTitle=function(){switch(this.level){case 2:return'"The chase begins"';case 3:return'"friend1s awakening"';case 4:return'"friend4s awakening"';case 5:return'"need for speed"';default:return'"nothing new"'}},this.showMessage=function(t,i){this.timer.stop(),this.pause=!0,$("#canvas-overlay-container").fadeIn(200),"none"!==$(".controls").css("display")&&$(".controls").slideToggle(200),$("#canvas-overlay-content #title").text(t),$("#canvas-overlay-content #text").html(i)},this.closeMessage=function(){$("#canvas-overlay-container").fadeOut(200),$(".controls").slideToggle(200)},this.pauseResume=function(){this.running?this.pause?(this.timer.stop(),this.pause=!1,this.closeMessage()):this.showMessage("Pause","Click to Resume"):(this.timer.start(),this.pause=!1,this.running=!0,this.closeMessage(),m())},this.init=function(t){console.log("init game "+t),0===t&&this.timer.reset(),$.ajax({url:z,async:!1,beforeSend:function(t){t.overrideMimeType&&t.overrideMimeType("application/json")},dataType:"json",success:function(t){w.map=t}});var i=0;$.each(this.map.posY,function(t,e){$.each(this.posX,function(){"pill"===this.type&&i++})}),this.pillCount=i,0===t&&(this.score.set(0),this.score.refresh(".score"),n.lives=3,w.level=1,this.refreshLevel(".level"),w.gameOver=!1),n.reset(),w.drawHearts(n.lives),this.enemyFriendFrightened=!1,this.enemyFriendFrightenedTimer=240,this.enemyFriendMode=0,this.enemyFriendModeTimer=200,null===P||void 0===P?(P=new u("friend2",7,5,"images/noimage.gif",2,2),Y=new u("friend1",8,5,"images/noimage.gif",13,11),M=new u("friend3",9,5,"images/noimage.gif",13,0),b=new u("friend4",10,5,"images/noimage.gif",2,11)):(P.reset(),Y.reset(),M.reset(),b.reset()),M.start(),Y.start(),P.start(),b.start()},this.check=function(){0===this.pillCount&&w.running&&this.nextLevel()},this.win=function(){},this.gameover=function(){},this.toPixelPos=function(t){return 30*t},this.toGridPos=function(t){return t%30/30},this.buildWalls=function(){w.wallColor=0===this.enemyFriendMode?"Blue":"Red",k=document.createElement("canvas"),k.width=w.canvas.width,k.height=w.canvas.height,X=k.getContext("2d"),X.fillStyle=w.wallColor,X.strokeStyle=w.wallColor,o(X,0,0,18,1),o(X,0,12,18,1),o(X,0,0,1,6),o(X,0,7,1,6),o(X,17,0,1,6),o(X,17,7,1,6),o(X,7,4,1,1),o(X,6,5,1,2),o(X,10,4,1,1),o(X,11,5,1,2),o(X,6,6,6,1),X.fillRect(16*n.radius,n.radius/2+8*n.radius+5,4*n.radius,1),o(X,4,0,1,2),o(X,13,0,1,2),o(X,2,2,1,2),o(X,6,2,2,1),o(X,15,2,1,2),o(X,10,2,2,1),o(X,2,3,2,1),o(X,14,3,2,1),o(X,5,3,1,1),o(X,12,3,1,1),o(X,3,3,1,3),o(X,14,3,1,3),o(X,3,4,1,1),o(X,14,4,1,1),o(X,0,5,2,1),o(X,3,5,2,1),o(X,16,5,2,1),o(X,13,5,2,1),o(X,0,7,2,2),o(X,16,7,2,2),o(X,3,7,2,2),o(X,13,7,2,2),o(X,4,8,2,2),o(X,12,8,2,2),o(X,5,8,3,1),o(X,10,8,3,1),o(X,2,10,1,1),o(X,15,10,1,1),o(X,7,10,4,1),o(X,4,11,2,2),o(X,12,11,2,2)}}function d(){this.score=0,this.set=function(t){this.score=t},this.add=function(t){this.score+=t},this.refresh=function(t){$(t).html("Score: "+this.score)}}function c(t,i,e,s,n){this.name=t,this.angle1=i,this.angle2=e,this.dirX=s,this.dirY=n,this.equals=function(t){return JSON.stringify(this)==JSON.stringify(t)}}function l(){this.dir=null,this.set=function(t){this.dir=t},this.get=function(){return this.dir}}function u(t,i,e,s,o,r){this.name=t,this.posX=30*i,this.posY=30*e,this.startPosX=30*i,this.startPosY=30*e,this.gridBaseX=o,this.gridBaseY=r,this.speed=w.enemyFriendSpeedNormal,this.images=JSON.parse('{"normal" : {"friend1" : "0","friend2" : "1","friend3" : "2","friend4" : "3"},"frightened1" : {"left" : "", "up": "", "right" : "", "down": ""},"frightened2" : {"left" : "", "up": "", "right" : "", "down": ""},"dead" : {"left" : "", "up": "", "right" : "", "down": ""}}'),this.image=new Image,this.image.src=s,this.enemyFriendHouse=!0,this.dazzled=!1,this.dead=!1,this.dazzle=function(){this.changeSpeed(w.enemyFriendSpeedDazzled),this.posX>0&&(this.posX=this.posX-this.posX%this.speed),this.posY>0&&(this.posY=this.posY-this.posY%this.speed),this.dazzled=!0},this.undazzle=function(){this.dead||this.changeSpeed(w.enemyFriendSpeedNormal),this.posX>0&&(this.posX=this.posX-this.posX%this.speed),this.posY>0&&(this.posY=this.posY-this.posY%this.speed),this.dazzled=!1},this.dazzleImg=new Image,this.dazzleImg.src="images/game/dazzled.svg",this.dazzleImg2=new Image,this.dazzleImg2.src="images/game/dazzled2.svg",this.deadImg=new Image,this.deadImg.src="images/game/dead.svg",this.direction=E,this.radius=n.radius,this.draw=function(t){this.dead?t.drawImage(this.deadImg,this.posX,this.posY,2*this.radius,2*this.radius):this.dazzled?n.beastModeTimer<50&&n.beastModeTimer%8>1?t.drawImage(this.dazzleImg2,this.posX,this.posY,2*this.radius,2*this.radius):t.drawImage(this.dazzleImg,this.posX,this.posY,2*this.radius,2*this.radius):t.drawImage(this.image,this.posX,this.posY,2*this.radius,2*this.radius)},this.getCenterX=function(){return this.posX+this.radius},this.getCenterY=function(){return this.posY+this.radius},this.reset=function(){this.dead=!1,this.posX=this.startPosX,this.posY=this.startPosY,this.enemyFriendHouse=!0,this.undazzle()},this.death=function(){this.dead||(w.score.add(100),this.dead=!0,this.changeSpeed(w.enemyFriendSpeedNormal))},this.changeSpeed=function(t){this.posX=Math.round(this.posX/t)*t,this.posY=Math.round(this.posY/t)*t,this.speed=t},this.move=function(){this.checkDirectionChange(),this.checkCollision(),this.enemyFriendHouse===!0&&("friend4"===this.name&&(this.stop=w.level<4||w.pillCount>104/3?!0:!1),"friend1"===this.name&&(this.stop=w.level<3||w.pillCount>74?!0:!1),5===this.getGridPosY()&&this.inGrid()&&(7===this.getGridPosX()&&this.setDirection(E),(8===this.getGridPosX()||9==this.getGridPosX())&&this.setDirection(D),10===this.getGridPosX()&&this.setDirection(S)),4!==this.getGridPosY()||8!==this.getGridPosX()&&9!==this.getGridPosX()||!this.inGrid()||(console.log("enemyFriendhouse -> false"),this.enemyFriendHouse=!1)),this.stop||(this.posX+=this.speed*this.dirX,this.posY+=this.speed*this.dirY,this.posX>=w.width-this.radius&&(this.posX=this.speed-this.radius),this.posX<=0-this.radius&&(this.posX=w.width-this.speed-this.radius),this.posY>=w.height-this.radius&&(this.posY=this.speed-this.radius),this.posY<=0-this.radius&&(this.posY=w.height-this.speed-this.radius))},this.checkCollision=function(){this.dead&&this.getGridPosX()===this.startPosX/30&&this.getGridPosY()===this.startPosY/30?this.reset():h(n.getCenterX(),this.getCenterX()-10,this.getCenterX()+10)&&h(n.getCenterY(),this.getCenterY()-10,this.getCenterY()+10)&&(this.dazzled||this.dead?this.death():n.death())},this.getNextDirection=function(){function t(t,i){return t.distance<i.distance?-1:t.distance>i.distance?1:0}var i=this.getGridPosX(),e=this.getGridPosY();w.getMapContent(i,e);var s,o,h;if(this.dead)h=this.startPosX/30,o=this.startPosY/30;else if(0==w.enemyFriendMode)h=this.gridBaseX,o=this.gridBaseY;else if(1==w.enemyFriendMode)switch(this.name){case"friend2":var r=n.direction,a=0==r.dirX?-r.dirY:r.dirX,d=0==r.dirY?-r.dirX:r.dirY;h=(n.getGridPosX()+4*a)%(w.width/n.radius+1),o=(n.getGridPosY()+4*d)%(w.height/n.radius+1);break;case"friend3":h=n.getGridPosX(),o=n.getGridPosY();break;case"friend1":h=n.getGridPosX()+2*n.direction.dirX,o=n.getGridPosY()+2*n.direction.dirY;var c=h-M.getGridPosX(),l=o-M.getGridPosY();h=Math.abs(M.getGridPosX()+2*c),o=Math.abs(M.getGridPosY()+2*l);break;case"friend4":h=n.getGridPosX(),o=n.getGridPosY();var u=Math.sqrt(Math.pow(i-h,2)+Math.pow(e-o,2));5>u&&(h=this.gridBaseX,o=this.gridBaseY)}var p=[{},{},{},{}];p[0].field=w.getMapContent(i,e-1),p[0].dir=D,p[0].distance=Math.sqrt(Math.pow(i-h,2)+Math.pow(e-1-o,2)),p[1].field=w.getMapContent(i,e+1),p[1].dir=x,p[1].distance=Math.sqrt(Math.pow(i-h,2)+Math.pow(e+1-o,2)),p[2].field=w.getMapContent(i+1,e),p[2].dir=E,p[2].distance=Math.sqrt(Math.pow(i+1-h,2)+Math.pow(e-o,2)),p[3].field=w.getMapContent(i-1,e),p[3].dir=S,p[3].distance=Math.sqrt(Math.pow(i-1-h,2)+Math.pow(e-o,2));var g=p.sort(t);s=this.dir;var f;if(this.dead)for(f=g.length-1;f>=0;f--)"wall"===g[f].field||g[f].dir.equals(this.getOppositeDirection())||(s=g[f].dir);else for(f=g.length-1;f>=0;f--)"wall"===g[f].field||"door"===g[f].field||g[f].dir.equals(this.getOppositeDirection())||(s=g[f].dir);return this.directionWatcher.set(s),s},this.setRandomDirection=function(){var t=Math.floor(10*Math.random()+1)%5;switch(t){case 1:this.setDirection(this.getOppositeDirection().equals(D)?x:D);break;case 2:this.setDirection(this.getOppositeDirection().equals(x)?D:x);break;case 3:this.setDirection(this.getOppositeDirection().equals(E)?S:E);break;case 4:this.setDirection(this.getOppositeDirection().equals(S)?E:S)}},this.reverseDirection=function(){console.log("reverseDirection: "+this.direction.name+" to "+this.getOppositeDirection().name),this.directionWatcher.set(this.getOppositeDirection())}}function p(){this.posX,this.posY,this.speed,this.dirX=E.dirX,this.dirY=E.dirY,this.direction,this.stop=!0,this.directionWatcher=new l,this.getNextDirection=function(){console.log("Figure getNextDirection")},this.checkDirectionChange=function(){this.inGrid()&&null==this.directionWatcher.get()&&this.getNextDirection(),null!=this.directionWatcher.get()&&this.inGrid()&&(this.setDirection(this.directionWatcher.get()),this.directionWatcher.set(null))},this.inGrid=function(){return this.posX%(2*this.radius)===0&&this.posY%(2*this.radius)===0?!0:!1},this.getOppositeDirection=function(){return this.direction.equals(D)?x:this.direction.equals(x)?D:this.direction.equals(E)?S:this.direction.equals(S)?E:void 0},this.move=function(){this.stop||(this.posX+=this.speed*this.dirX,this.posY+=this.speed*this.dirY,this.posX>=w.width-this.radius&&(this.posX=this.speed-this.radius),this.posX<=0-this.radius&&(this.posX=w.width-this.speed-this.radius),this.posY>=w.height-this.radius&&(this.posY=this.speed-this.radius),this.posY<=0-this.radius&&(this.posY=w.height-this.speed-this.radius))},this.stop=function(){this.stop=!0},this.start=function(){this.stop=!1},this.getGridPosX=function(){return(this.posX-this.posX%30)/30},this.getGridPosY=function(){return(this.posY-this.posY%30)/30},this.setDirection=function(t){this.dirX=t.dirX,this.dirY=t.dirY,this.angle1=t.angle1,this.angle2=t.angle2,this.direction=t},this.setPosition=function(t,i){this.posX=t,this.posY=i}}function g(){console.log("check AppCache"),window.applicationCache.addEventListener("updateready",function(t){console.log("AppCache: updateready"),window.applicationCache.status===window.applicationCache.UPDATEREADY&&(window.applicationCache.swapCache(),confirm("A new version of this site is available. Load it?")&&window.location.reload())},!1),window.applicationCache.addEventListener("cached",function(t){console.log("AppCache: cached")},!1)}function f(){w.score.refresh(".score"),y.beginPath(),y.fillStyle="White",y.strokeStyle="White";var t;$.each(w.map.posY,function(i,e){t=this.row,$.each(this.posX,function(){"pill"===this.type?(y.arc(w.toPixelPos(this.col-1)+n.radius,w.toPixelPos(t-1)+n.radius,w.pillSize,0*Math.PI,2*Math.PI),y.moveTo(w.toPixelPos(this.col-1),w.toPixelPos(t-1))):"eatfruit"===this.type&&(y.arc(w.toPixelPos(this.col-1)+n.radius,w.toPixelPos(t-1)+n.radius,w.eatfruitSizeCurrent,0*Math.PI,2*Math.PI),y.moveTo(w.toPixelPos(this.col-1),w.toPixelPos(t-1)))})}),y.fill(),y.drawImage(k,0,0),w.running===!0&&(P.draw(y),M.draw(y),Y.draw(y),b.draw(y),y.beginPath(),y.fillStyle="Yellow",y.strokeStyle="Yellow",y.arc(n.posX+n.radius,n.posY+n.radius,n.radius,n.angle1*Math.PI,n.angle2*Math.PI),y.lineTo(n.posX+n.radius,n.posY+n.radius),y.stroke(),y.fill())}function m(){_.width=_.width,f(),1===w.deathAnimation&&n.deathAnimation(),w.pause!==!0&&(n.move(),n.eat(),n.checkDirectionChange(),n.checkCollisions(),M.move(),Y.move(),P.move(),b.move(),w.checkenemyFriendMode()),w.check(),setTimeout(m,w.refreshRate)}function v(t){switch(t.keyCode){case 38:t.preventDefault();case 87:n.directionWatcher.set(D);break;case 40:t.preventDefault();case 83:n.directionWatcher.set(x);break;case 37:t.preventDefault();case 65:n.directionWatcher.set(S);break;case 39:t.preventDefault();case 68:n.directionWatcher.set(E);break;case 78:$("#playerName").is(":focus")||(w.pause=1,w.newGame());break;case 77:w.toggleSound();break;case 27:t.preventDefault(),w.gameOver!==!0&&$("#game-content").is(":visible")&&w.pauseResume();break;case 32:t.preventDefault(),w.gameOver!==!0&&$("#game-content").is(":visible")&&w.pauseResume()}}var _,y,w,k,X,Y,M,b,P,z="/data/map.json",T=function(){var t=null,i={};return i.enableLogger=function(){null!==t&&(window.console.log=t)},i.disableLogger=function(){t=console.log,window.console.log=function(){}},i}();w=new a;var C={};C.play=function(t){if(1==w.soundfx){var i=document.getElementById(t);null!==i?i.play():console.log(t+" not found")}};var D=new c("up",1.75,1.25,0,-1),S=new c("left",1.25,.75,-1,0),x=new c("down",.75,.25,0,1),E=new c("right",.25,1.75,1,0);u.prototype=new p,n.prototype=new p,n=new n,w.buildWalls(),$(document).ready(function(){$.ajaxSetup({mimeType:"application/json"}),$.ajaxSetup({beforeSend:function(t){t.overrideMimeType&&t.overrideMimeType("application/json")}}),null!=window.applicationCache&&g(),window.addEventListener("keydown",v,!0),$("#canvas-container").click(function(){w.gameOver!==!0&&w.pauseResume()}),$("body").on("click","#score-submit",function(){console.log("submit highscore pressed"),""===$("#playerName").val()||void 0===$("#playerName").val()?$("#form-validater").html("Please enter a name<br/>"):($("#form-validater").html(""),s())}),$("body").on("click","#show-highscore",function(){w.showContent("highscore-content"),t()}),Hammer(".container").on("swiperight",function(t){$("#game-content").is(":visible")&&(t.gesture.preventDefault(),n.directionWatcher.set(E))}),Hammer(".container").on("swipeleft",function(t){$("#game-content").is(":visible")&&(t.gesture.preventDefault(),n.directionWatcher.set(S))}),Hammer(".container").on("swipeup",function(t){$("#game-content").is(":visible")&&(t.gesture.preventDefault(),n.directionWatcher.set(D))}),Hammer(".container").on("swipedown",function(t){$("#game-content").is(":visible")&&(t.gesture.preventDefault(),n.directionWatcher.set(x))}),$(document).on("touchend mousedown","#up",function(t){t.preventDefault(),window.navigator.vibrate(200),n.directionWatcher.set(D)}),$(document).on("touchend mousedown","#down",function(t){t.preventDefault(),window.navigator.vibrate(200),n.directionWatcher.set(x)}),$(document).on("touchend mousedown","#left",function(t){t.preventDefault(),window.navigator.vibrate(200),n.directionWatcher.set(S)}),$(document).on("touchend mousedown","#right",function(t){t.preventDefault(),window.navigator.vibrate(200),n.directionWatcher.set(E)}),$(document).on("click","#newGame",function(){w.newGame()}),$(document).on("click","#highScore",function(){w.showContent("highscore-content"),t()}),$(document).on("click","#back",function(){w.showContent("game-content")}),$(document).on("click",".controlSound",function(){w.toggleSound()}),_=$("#gameCanvas").get(0),y=_.getContext("2d"),w.init(0),T.disableLogger(),f()})}var VirtualJoystick=function(t){t=t||{},this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._stickEl=t.stickElement||this._buildJoystickStick(),this._baseEl=t.baseElement||this._buildJoystickBase(),this._mouseSupport=void 0!==t.mouseSupport?t.mouseSupport:!1,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._useCssTransform=void 0!==t.useCssTransform?t.useCssTransform:!1,this._container.style.position="relative",this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,this._stationaryBase===!0&&(this._baseEl.style.display="",this._baseEl.style.left=this._baseX-this._baseEl.width/2+"px",this._baseEl.style.top=this._baseY-this._baseEl.height/2+"px"),this._transform=this._useCssTransform?this._getTransformProperty():!1,this._has3d=this._check3D();var i=function(t,i){return function(){return t.apply(i,arguments)}};this._$onTouchStart=i(this._onTouchStart,this),this._$onTouchEnd=i(this._onTouchEnd,this),this._$onTouchMove=i(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=i(this._onMouseDown,this),this._$onMouseUp=i(this._onMouseUp,this),this._$onMouseMove=i(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},VirtualJoystick.touchScreenAvailable=function(){return"createTouch"in document?!0:!1},function(t){t.addEventListener=function(t,i){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(i),i},t.removeEventListener=function(t,i){void 0===this._events&&(this._events={}),t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(i),1)},t.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t]){for(var i=this._events[t].slice(),e=0;e<i.length;e++){var s=i[e].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==s)return s}return void 0}}}(VirtualJoystick.prototype),VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX},VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY},VirtualJoystick.prototype.up=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),i=this.deltaY();return i>=0?!1:Math.abs(t)>2*Math.abs(i)?!1:!0},VirtualJoystick.prototype.down=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),i=this.deltaY();return 0>=i?!1:Math.abs(t)>2*Math.abs(i)?!1:!0},VirtualJoystick.prototype.right=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),i=this.deltaY();return 0>=t?!1:Math.abs(i)>2*Math.abs(t)?!1:!0},VirtualJoystick.prototype.left=function(){if(this._pressed===!1)return!1;var t=this.deltaX(),i=this.deltaY();return t>=0?!1:Math.abs(i)>2*Math.abs(t)?!1:!0},VirtualJoystick.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",this._stationaryBase===!1&&(this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0)},VirtualJoystick.prototype._onDown=function(t,i){if(this._pressed=!0,this._stationaryBase===!1&&(this._baseX=t,this._baseY=i,this._baseEl.style.display="",this._move(this._baseEl.style,this._baseX-this._baseEl.width/2,this._baseY-this._baseEl.height/2)),this._stickX=t,this._stickY=i,this._limitStickTravel===!0){var e=this.deltaX(),s=this.deltaY(),n=Math.sqrt(e*e+s*s);if(n>this._stickRadius){var o=e/n,h=s/n;this._stickX=o*this._stickRadius+this._baseX,this._stickY=h*this._stickRadius+this._baseY}}this._stickEl.style.display="",this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2)},VirtualJoystick.prototype._onMove=function(t,i){if(this._pressed===!0){if(this._stickX=t,this._stickY=i,this._limitStickTravel===!0){var e=this.deltaX(),s=this.deltaY(),n=Math.sqrt(e*e+s*s);if(n>this._stickRadius){var o=e/n,h=s/n;this._stickX=o*this._stickRadius+this._baseX,this._stickY=h*this._stickRadius+this._baseY}}this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2)}},VirtualJoystick.prototype._onMouseUp=function(){return this._onUp()},VirtualJoystick.prototype._onMouseDown=function(t){t.preventDefault();var i=t.clientX,e=t.clientY;return this._onDown(i,e)},VirtualJoystick.prototype._onMouseMove=function(t){var i=t.clientX,e=t.clientY;return this._onMove(i,e)},VirtualJoystick.prototype._onTouchStart=function(t){var i,e;if(null!==this._touchIdx)return this._onDown(i,e);var s=this.dispatchEvent("touchStartValidation",t);if(s===!1)return this._onDown(i,e);this.dispatchEvent("touchStart",t),t.preventDefault();var n=t.changedTouches[0];return this._touchIdx=n.identifier,i=n.pageX,e=n.pageY,this._onDown(i,e)},VirtualJoystick.prototype._onTouchEnd=function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var i=t.changedTouches,e=0;e<i.length&&i[e].identifier!==this._touchIdx;e++);if(e!==i.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}},VirtualJoystick.prototype._onTouchMove=function(t){if(null===this._touchIdx)return this._onMove(n,o);for(var i=t.changedTouches,e=0;e<i.length&&i[e].identifier!==this._touchIdx;e++);if(e!==i.length){var s=i[e];t.preventDefault();var n=s.pageX,o=s.pageY;return this._onMove(n,o)}},VirtualJoystick.prototype._buildJoystickBase=function(){var t=document.createElement("canvas");t.width=126,t.height=126;var i=t.getContext("2d");return i.beginPath(),i.strokeStyle=this._strokeStyle,i.lineWidth=6,i.arc(t.width/2,t.width/2,40,0,2*Math.PI,!0),i.stroke(),i.beginPath(),i.strokeStyle=this._strokeStyle,i.lineWidth=2,i.arc(t.width/2,t.width/2,60,0,2*Math.PI,!0),i.stroke(),t},VirtualJoystick.prototype._buildJoystickStick=function(){var t=document.createElement("canvas");t.width=86,t.height=86;var i=t.getContext("2d");return i.beginPath(),i.strokeStyle=this._strokeStyle,i.lineWidth=6,i.arc(t.width/2,t.width/2,40,0,2*Math.PI,!0),i.stroke(),t},VirtualJoystick.prototype._move=function(t,i,e){this._transform?t[this._transform]=this._has3d?"translate3d("+i+"px,"+e+"px, 0)":"translate("+i+"px,"+e+"px)":(t.left=i+"px",t.top=e+"px")},VirtualJoystick.prototype._getTransformProperty=function(){for(var t,i=["webkitTransform","MozTransform","msTransform","OTransform","transform"],e=document.createElement("p"),s=0;s<i.length;s++)if(t=i[s],null!=e.style[t])return t},VirtualJoystick.prototype._check3D=function(){var t=this._getTransformProperty();if(!t||!window.getComputedStyle)return module.exports=!1;var i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},e=document.createElement("div");e.style[t]="translate3d(1px,1px,1px)",document.body.insertBefore(e,null);var s=getComputedStyle(e).getPropertyValue(i[t]);document.body.removeChild(e);var n=null!=s&&s.length&&"none"!==s;return n},Play();